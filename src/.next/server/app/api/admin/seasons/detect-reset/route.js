"use strict";(()=>{var e={};e.id=8012,e.ids=[8012],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},27169:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>g,originalPathname:()=>y,patchFetch:()=>O,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>x});var n={};r.r(n),r.d(n,{POST:()=>l,dynamic:()=>d,runtime:()=>c});var s=r(6170),o=r(8533),a=r(54387),i=r(40064),u=r(16395);(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}();let c="nodejs",d="force-dynamic";async function l(e){try{let e=await (0,u.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!e||"ADMIN"!==e.user.role)return i.Z.json({error:"Admin access required"},{status:403});let t=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).snapshot.findMany({include:{players:{select:{merits:!0,playerId:!0}}},orderBy:{timestamp:"desc"},take:10});if(t.length<3)return i.Z.json({resetDetected:!1,message:"Not enough snapshots to analyze merit trends"});let r=!1,n=null,s=null;for(let e=0;e<t.length-1;e++){let o=t[e],a=t[e+1],i=new Map(o.players.map(e=>[e.playerId,parseInt(e.merits||"0")])),u=new Map(a.players.map(e=>[e.playerId,parseInt(e.merits||"0")])),c=Array.from(i.keys()).filter(e=>u.has(e));if(c.length<10)continue;let d=0,l=0,p=0;c.forEach(e=>{let t=i.get(e)||0,r=u.get(e)||0;if(t<r){d++;let e=r-t;l+=e,(e>.5*r||e>1e5)&&p++}});let m=d/c.length*100,h=p/c.length*100;if(m>70&&h>30){r=!0,n=o.timestamp,s=o;break}}if(r&&n&&s){let e=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).season.count()+1,t=new Date(n).toLocaleDateString("en-US",{month:"long",year:"numeric"}),r=`Season ${e} (${t})`;return i.Z.json({resetDetected:!0,resetDate:n,resetSnapshotId:s.id,suggestedSeasonName:r,message:`Merit reset detected in snapshot from ${new Date(n).toLocaleDateString()}`})}return i.Z.json({resetDetected:!1,message:"No merit reset detected in recent snapshots"})}catch(e){return console.error("Error detecting merit reset:",e),i.Z.json({error:"Internal server error"},{status:500})}}let p=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/seasons/detect-reset/route",pathname:"/api/admin/seasons/detect-reset",filename:"route",bundlePath:"app/api/admin/seasons/detect-reset/route"},resolvedPagePath:"/Users/ciaranobrien/player-tracker/src/app/api/admin/seasons/detect-reset/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:f,headerHooks:g,staticGenerationBailout:x}=p,y="/api/admin/seasons/detect-reset/route";function O(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[3499,7386,6395],()=>r(27169));module.exports=n})();