"use strict";(()=>{var e={};e.id=9992,e.ids=[9992],e.modules={98432:e=>{e.exports=require("bcryptjs")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},51608:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>w,originalPathname:()=>x,patchFetch:()=>j,requestAsyncStorage:()=>h,routeModule:()=>m,serverHooks:()=>O,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>E});var s={};t.r(s),t.d(s,{DELETE:()=>l,PATCH:()=>p,dynamic:()=>c,runtime:()=>d});var n=t(6170),o=t(8533),a=t(54387),i=t(40064),u=t(16395);(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e})(),function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}();let d="nodejs",c="force-dynamic";async function l(e,{params:r}){try{let e=await (0,u.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!e||"ADMIN"!==e.user.role)return i.Z.json({error:"Admin access required"},{status:403});let{userId:t}=r;if(t===e.user.id)return i.Z.json({error:"Cannot delete your own account"},{status:400});return await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).user.delete({where:{id:t}}),i.Z.json({success:!0})}catch(e){return console.error("Error deleting user:",e),i.Z.json({error:"Failed to delete user"},{status:500})}}async function p(e,{params:r}){try{let s=await (0,u.getServerSession)(Object(function(){var e=Error("Cannot find module '@/lib/auth'");throw e.code="MODULE_NOT_FOUND",e}()));if(!s||"ADMIN"!==s.user.role)return i.Z.json({error:"Admin access required"},{status:403});let{userId:n}=r,{status:o,role:a,username:d,name:c,resetPassword:l}=await e.json();if(o&&!["PENDING","APPROVED","REJECTED"].includes(o))return i.Z.json({error:"Invalid status"},{status:400});if(a&&!["ADMIN","VIEWER"].includes(a))return i.Z.json({error:"Invalid role"},{status:400});if(d&&d.length<3)return i.Z.json({error:"Username must be at least 3 characters"},{status:400});if(n===s.user.id&&o&&"APPROVED"!==o)return i.Z.json({error:"Cannot change your own approval status"},{status:400});if(d){let e=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).user.findUnique({where:{username:d}});if(e&&e.id!==n)return i.Z.json({error:"Username already exists"},{status:400})}let p={};o&&(p.status=o),a&&(p.role=a),d&&(p.username=d),void 0!==c&&(p.name=c||null);let m=null;if(l){m=Math.random().toString(36).slice(-8)+Math.random().toString(36).slice(-8);let e=await Promise.resolve().then(t.t.bind(t,98432,23));p.password=await e.hash(m,12)}let h=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).user.update({where:{id:n},data:p,select:{id:!0,username:!0,name:!0,role:!0,status:!0,createdAt:!0,updatedAt:!0}}),f={success:!0,user:h};return m&&(f.newPassword=m,f.message="User updated and password reset. Share the new temporary password with them."),i.Z.json(f)}catch(e){return console.error("Error updating user:",e),i.Z.json({error:"Failed to update user"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/admin/users/[userId]/route",pathname:"/api/admin/users/[userId]",filename:"route",bundlePath:"app/api/admin/users/[userId]/route"},resolvedPagePath:"/Users/ciaranobrien/player-tracker/src/app/api/admin/users/[userId]/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:f,serverHooks:O,headerHooks:w,staticGenerationBailout:E}=m,x="/api/admin/users/[userId]/route";function j(){return(0,a.patchFetch)({serverHooks:O,staticGenerationAsyncStorage:f})}}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[3499,7386,6395],()=>t(51608));module.exports=s})();