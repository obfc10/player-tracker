"use strict";(()=>{var e={};e.id=8986,e.ids=[8986],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},88952:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>h,originalPathname:()=>g,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>u,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>y});var r={};a.r(r),a.d(r,{GET:()=>c,dynamic:()=>d,runtime:()=>i});var n=a(6170),l=a(8533),s=a(54387),o=a(40064);!function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}();let i="nodejs",d="force-dynamic";async function c(e){try{let{searchParams:t}=new URL(e.url),a=parseInt(t.get("limit")||"50"),r=parseInt(t.get("page")||"1"),n=parseInt(t.get("daysAgo")||"30"),l=new Date;l.setDate(l.getDate()-n);let s=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).player.count({where:{hasLeftRealm:!0,leftRealmAt:{gte:l}}}),i=(await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).player.findMany({where:{hasLeftRealm:!0,leftRealmAt:{gte:l}},include:{snapshots:{orderBy:{snapshot:{timestamp:"desc"}},take:1,include:{snapshot:!0}}},orderBy:{leftRealmAt:"desc"},skip:(r-1)*a,take:a})).map((e,t)=>{let n=e.snapshots[0];return{rank:(r-1)*a+t+1,lordId:e.lordId,currentName:e.currentName,hasLeftRealm:e.hasLeftRealm,lastSeenAt:e.lastSeenAt,leftRealmAt:e.leftRealmAt,daysGone:e.lastSeenAt?Math.floor((new Date().getTime()-new Date(e.lastSeenAt).getTime())/864e5):null,daysSinceDetected:e.leftRealmAt?Math.floor((new Date().getTime()-new Date(e.leftRealmAt).getTime())/864e5):null,lastKnownData:n?{allianceTag:n.allianceTag,cityLevel:n.cityLevel,currentPower:parseInt(n.currentPower||"0"),merits:parseInt(n.merits||"0"),victories:n.victories,defeats:n.defeats,snapshotDate:n.snapshot.timestamp}:null}}),d=Math.ceil(s/a);return o.Z.json({players:i,totalPlayers:s,currentPage:r,totalPages:d,limit:a,daysAgo:n,summary:{totalLeft:s,recentDepartures:i.filter(e=>e.daysGone&&e.daysGone<=7).length,weeklyDepartures:i.filter(e=>e.daysGone&&e.daysGone<=7&&e.daysGone>0).length}})}catch(e){return console.error("Error fetching left realm players:",e),o.Z.json({error:"Failed to fetch left realm players"},{status:500})}}let u=new n.AppRouteRouteModule({definition:{kind:l.x.APP_ROUTE,page:"/api/players/left-realm/route",pathname:"/api/players/left-realm",filename:"route",bundlePath:"app/api/players/left-realm/route"},resolvedPagePath:"/Users/ciaranobrien/player-tracker/src/app/api/players/left-realm/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:f,headerHooks:h,staticGenerationBailout:y}=u,g="/api/players/left-realm/route";function w(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[3499,7386],()=>a(88952));module.exports=r})();