"use strict";(()=>{var e={};e.id=7353,e.ids=[7353],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},86572:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>c,routeModule:()=>u,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>I});var a={};r.r(a),r.d(a,{GET:()=>d,dynamic:()=>l,runtime:()=>p});var n=r(6170),o=r(8533),s=r(54387),i=r(40064);!function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}();let p="nodejs",l="force-dynamic";async function d(e,{params:t}){try{let e=t.id,r=await Object(function(){var e=Error("Cannot find module '@/lib/db'");throw e.code="MODULE_NOT_FOUND",e}()).player.findUnique({where:{lordId:e},include:{nameHistory:{orderBy:{detectedAt:"desc"},take:20},allianceHistory:{orderBy:{detectedAt:"desc"},take:20},snapshots:{include:{snapshot:!0},orderBy:{snapshot:{timestamp:"desc"}},take:100}}});if(!r)return i.Z.json({error:"Player not found"},{status:404});let a=r.snapshots[0];r.snapshots[r.snapshots.length-1];let n=function(e){if(e.length<2)return{powerGrowthRate:0,combatEfficiency:0,activityLevel:0,resourceEfficiency:0,killDeathRatio:0,totalKills:0,totalDeaths:0,averageDailyGrowth:0};let t=e[0],r=e[e.length-1],a=Math.max(1,(new Date(t.snapshot.timestamp).getTime()-new Date(r.snapshot.timestamp).getTime())/864e5),n=parseInt(t.currentPower)-parseInt(r.currentPower),o=parseInt(t.unitsKilled),s=parseInt(t.unitsDead);return{powerGrowthRate:Math.round(n/a),combatEfficiency:s>0?(o/s).toFixed(2):"N/A",activityLevel:Math.round(t.helpsGiven/a),resourceEfficiency:function(e){let t=parseInt(e.goldSpent)+parseInt(e.woodSpent)+parseInt(e.oreSpent)+parseInt(e.manaSpent)+parseInt(e.gemsSpent),r=parseInt(e.gold)+parseInt(e.wood)+parseInt(e.ore)+parseInt(e.mana)+parseInt(e.gems);return t>0?(r/t*100).toFixed(1):"0"}(t),killDeathRatio:s>0?(o/s).toFixed(2):"N/A",totalKills:o,totalDeaths:s,averageDailyGrowth:Math.round(n/a),daysTracked:Math.round(a),powerBreakdown:{building:parseInt(t.buildingPower),hero:parseInt(t.heroPower),legion:parseInt(t.legionPower),tech:parseInt(t.techPower)},killBreakdown:{t1:parseInt(t.t1KillCount),t2:parseInt(t.t2KillCount),t3:parseInt(t.t3KillCount),t4:parseInt(t.t4KillCount),t5:parseInt(t.t5KillCount)}}}(r.snapshots),o=function(e){let t=[...e].reverse();return{powerTrend:t.map(e=>({date:new Date(e.snapshot.timestamp).toLocaleDateString(),power:parseInt(e.currentPower)})),combatTrend:t.map(e=>({date:new Date(e.snapshot.timestamp).toLocaleDateString(),kills:parseInt(e.unitsKilled),deaths:parseInt(e.unitsDead)})),resourceTrend:t.map(e=>({date:new Date(e.snapshot.timestamp).toLocaleDateString(),gold:parseInt(e.gold),wood:parseInt(e.wood),ore:parseInt(e.ore),mana:parseInt(e.mana),gems:parseInt(e.gems)})),activityTrend:t.map(e=>({date:new Date(e.snapshot.timestamp).toLocaleDateString(),helps:e.helpsGiven,sieges:e.citySieges,scouted:e.scouted}))}}(r.snapshots);return i.Z.json({player:{lordId:r.lordId,currentName:r.currentName,nameHistory:r.nameHistory,allianceHistory:r.allianceHistory,createdAt:r.createdAt,updatedAt:r.updatedAt},latestSnapshot:a?{...a,currentPower:parseInt(a.currentPower),power:parseInt(a.power),unitsKilled:parseInt(a.unitsKilled),unitsDead:parseInt(a.unitsDead),merits:parseInt(a.merits)}:null,stats:n,chartData:o,snapshotCount:r.snapshots.length})}catch(e){return console.error("Error fetching player:",e),i.Z.json({error:"Failed to fetch player data"},{status:500})}}let u=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/players/[id]/route",pathname:"/api/players/[id]",filename:"route",bundlePath:"app/api/players/[id]/route"},resolvedPagePath:"/Users/ciaranobrien/player-tracker/src/app/api/players/[id]/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:c,staticGenerationAsyncStorage:h,serverHooks:m,headerHooks:w,staticGenerationBailout:I}=u,y="/api/players/[id]/route";function g(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[3499,7386],()=>r(86572));module.exports=a})();